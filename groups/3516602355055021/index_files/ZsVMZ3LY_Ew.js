if (self.CavalryLogger) { CavalryLogger.start_js(["AKSRO"]); }

__d("MessengerGalleryDetailViewHeader.react",["cx","React","joinClasses"],function(a,b,c,d,e,f,g){"use strict";var h=b("React");function a(){return h.jsx("div",{className:b("joinClasses")("_8q9o _5l-3"),children:h.jsx("div",{className:"_8q9p",children:"Gallery"})})}e.exports=a},null);
__d("MessengerGalleryMediaAction.react",["ix","cx","fbt","CurrentUser","Image.react","ImmutableObject","MessengerReactionsMenu.react","React","asset","gkx","joinClasses","nullthrows"],function(a,b,c,d,e,f,g,h,i){"use strict";var j=b("React");c=b("React");var k=c.useRef,l=c.useState;function a(){var a=k(),c=l(!1),d=c[0],e=c[1];c=b("CurrentUser").getAccountID();c=new(b("ImmutableObject"))({reactions:{},thread_id:"user:"+c});return j.jsxs("div",{className:"_8yx0",children:[b("gkx")("1281178")?j.jsxs("button",{className:b("joinClasses")("_8sop","_5zvq","_7i2o"),ref:a,"aria-label":i._("Reply"),onClick:function(){},size:24,children:[j.jsx(b("Image.react"),{src:g("559673")}),d?j.jsx(b("MessengerReactionsMenu.react"),{entryPoint:"dot_menu",message:c,onHide:function(){e(!1)},refProp:function(){return b("nullthrows")(a.current)}}):null]}):null,b("gkx")("1251661")?j.jsxs("button",{className:b("joinClasses")("_8sop","_5zvq","_7i2o","_8yx0"),ref:a,"aria-label":i._("React"),onClick:function(){e(!0)},size:24,children:[j.jsx(b("Image.react"),{src:g("559648")}),d?j.jsx(b("MessengerReactionsMenu.react"),{entryPoint:"dot_menu",message:c,onHide:function(){e(!1)},refProp:function(){return b("nullthrows")(a.current)}}):null]}):null]})}e.exports=a},null);
__d("MessengerGalleryDetailViewDetailContainer.react",["cx","fbt","AsyncRequest","CurrentUser","Image.react","MercuryIDs","MessengerConversation.react","MessengerErrorBoundary.react","MessengerGalleryMediaAction.react","MessengerScrollableArea.react","MessengerSpinner.react","MessengerState.re","MessengerVideoPlayer.react","Random","React","ShimButton.react","Vector","XMessagingGalleryMediaDetailsController","emptyFunction","immutable","joinClasses"],function(a,b,c,d,e,f,g,h){"use strict";var i=b("React");c=b("React");var j=c.useEffect,k=c.useState;function a(a){var c=i.createRef();j(function(){var a=c==null?void 0:c.current;a!=null&&a.scrollToTop()},[c]);var d=b("CurrentUser").getAccountID(),e=a.attachmentID,f=a.isLoading,g=a.messengerState,l=a.onSetIsLoading,m=k(""),n=m[0],o=m[1];m=k();var p=m[0],q=m[1];m=k("");var r=m[0],s=m[1];m=k([]);var t=m[0],u=m[1];m=k();var v=m[0],w=m[1];m=k();var x=m[0],y=m[1];m=k(0);var z=m[0],A=m[1];m=k(0);var B=m[0],C=m[1];j(function(){l(!0);var a=b("XMessagingGalleryMediaDetailsController").getURIBuilder().setFBID("attachment_id",String(e)).getURI(),c=new(b("AsyncRequest"))().setURI(a).setMethod("POST").setHandler(function(a){s(a.payload.time),o(a.payload.thread_name),q(a.payload.thread_iris_id),u(a.payload.messages),w(a.payload.uri),y(a.payload.type),C(a.payload.width),A(a.payload.height),l(!1)}).setReadOnly(!0);c.send();return function(){return c.abort()}},[l,e]);return i.jsxs("div",{className:"_8q-0 _5l-3",children:[i.jsxs("div",{className:"_8yxk _5l-3",children:[i.jsxs(b("ShimButton.react"),{className:"_3bm2",onClick:a.onCloseViewer,children:[i.jsx("div",{className:"_3bm3"}),h._("Back")]}),i.jsx("div",{className:"_3bm4",children:n})]}),i.jsx("div",{className:b("joinClasses")("_8vqw _5l-3"),children:i.jsx(b("MessengerScrollableArea.react"),{width:window.innerWidth,children:f?i.jsx("div",{className:"_8q9s",children:i.jsx(b("MessengerSpinner.react"),{size:b("MessengerSpinner.react").large_size})}):i.jsxs(i.Fragment,{children:[x=="video"?i.jsx(b("MessengerVideoPlayer.react"),{isVisible:!0,isOnStage:!0,videoData:{legacy_attachment_id:e,original_dimensions:{x:B,y:z}},stageDimensions:new(b("Vector"))(Math.floor(b("Vector").getViewportDimensions().x*2/3),Math.floor(b("Vector").getViewportDimensions().y/2))}):i.jsx(b("Image.react"),{className:b("joinClasses")("_8qb7"+(B<z?" _8yw_":"")+(B>=z?" _8yw-":"")),src:v}),i.jsx("div",{className:"_8q-1",children:r}),i.jsx(b("MessengerGalleryMediaAction.react"),{}),i.jsx(b("MessengerErrorBoundary.react"),{component:"conversation",children:i.jsx(b("MessengerConversation.react"),{className:"_8q-2",ref:c,deliveryTimestamp:0,fetchMessages:b("emptyFunction"),innerClassName:"_8yx1",maxWidth:160,messages:b("immutable").List(t.map(function(a){return{key:b("Random").uint32(),author:a.sender,body:a.body,message_id:a.message_id,timestamp:a.timestamp}})),threadID:(m=p)!=null?m:b("MercuryIDs").getThreadIDFromUserID(d),viewer:d,onRead:b("emptyFunction"),messengerState:g,readReceipts:b("MessengerState.re").readReceiptsPerThread(g)})})]})})})]})}e.exports=a},null);
__d("MessengerGalleryDetailViewPagers.react",["cx","fbt","LeftRight.react","React","ShimButton.react"],function(a,b,c,d,e,f,g,h){"use strict";var i=b("React");a=function(a){return i.jsxs(b("LeftRight.react"),{children:[i.jsx(b("ShimButton.react"),{onClick:a.onNavigateLeft,"aria-disabled":a.disablePrevArrow,"aria-label":h._("Previous"),className:"_322u _2bbb _50-m"+(a.disablePrevArrow?"":" _8qh8")+" _8qhs",children:i.jsx("div",{className:(a.disablePrevArrow?"":"_4ksl")+(a.disablePrevArrow?"":" _4ksm")})}),i.jsx(b("ShimButton.react"),{onClick:a.onNavigateRight,"aria-disabled":a.disableNextArrow,"aria-label":h._("Next"),className:"_322u _2bbc _50-m"+(a.disableNextArrow?"":" _8qh8")+" _8qhs",children:i.jsx("div",{className:(a.disableNextArrow?"":"_4ksl")+(a.disableNextArrow?"":" _4kso")})})]})};e.exports=a},null);
__d("MessengerGalleryDetailViewSpotlightContainer.react",["cx","CurrentUser","KeyEventController","MessengerGalleryDetailViewDetailContainer.react","MessengerGalleryDetailViewPagers.react","MessengerState.re","React","SpotlightViewer","SubscriptionsHandler"],function(a,b,c,d,e,f,g){"use strict";var h=b("React");a=function(a){babelHelpers.inheritsLoose(c,a);function c(){var c,d;for(var e=arguments.length,f=new Array(e),g=0;g<e;g++)f[g]=arguments[g];return(c=d=a.call.apply(a,[this].concat(f))||this,d.state={isLoading:!0},d.$1=new(b("SubscriptionsHandler"))(),d.$4=function(a){d.setState({isLoading:a})},d.$2=function(){var a=d.props.onNavigateLeft;d.$4(!0);a()},d.$3=function(){var a=d.props.onNavigateRight;d.$4(!0);a()},c)||babelHelpers.assertThisInitialized(d)}var d=c.prototype;d.componentDidMount=function(){var a=this;b("KeyEventController").registerKey("LEFT",function(){a.$2();return!1});b("KeyEventController").registerKey("RIGHT",function(){a.$3();return!1})};d.componentWillUnmount=function(){this.props.onCloseViewer(),this.$1&&this.$1.release()};d.render=function(){var a=this,c=this.props,d=c.imageIndex,e=c.imageList,f=this.state.isLoading;return h.jsx(b("MessengerState.re").jsComponent,{fbid:b("CurrentUser").getAccountID(),children:function(c){return h.jsx("div",{children:h.jsxs(b("SpotlightViewer"),{className:"_3ode",onHide:a.props.onCloseViewer,open:a.props.showViewer,children:[h.jsx(b("MessengerGalleryDetailViewDetailContainer.react"),{attachmentID:e[d].attachment_id,isLoading:f,imageIndex:d,imageList:e,messengerState:c,onCloseViewer:a.props.onCloseViewer,onSetIsLoading:a.$4}),h.jsx(b("MessengerGalleryDetailViewPagers.react"),{disablePrevArrow:d<=0,disableNextArrow:d>=e.length-1,onNavigateLeft:a.$2,onNavigateRight:a.$3})]})})}})};return c}(h.Component);e.exports=a},null);
__d("MessengerGalleryMemoriesViewGrid.react",["cx","fbt","Image.react","React","joinClasses"],function(a,b,c,d,e,f,g,h){"use strict";var i=b("React");a=function(a){babelHelpers.inheritsLoose(c,a);function c(){var b,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(b=c=a.call.apply(a,[this].concat(e))||this,c.state={onHovered:!1},b)||babelHelpers.assertThisInitialized(c)}var d=c.prototype;d.onMouseMove=function(){this.setState(function(a){return{onHovered:!a.onHovered}})};d.render=function(){var a=this,c=h._({"*":"{number} Years Ago","_1":"1 Year Ago"},[h._plural(this.props.yearsAgo,"number")]);return i.jsxs("div",{className:b("joinClasses")("_5l-m"+(this.state.onHovered?" _8qh8":"")),children:[i.jsx(b("Image.react"),{className:"_8qbi",onClick:this.props.onClick,src:this.props.coverImage.uri,onMouseOver:function(){a.onMouseMove()},onMouseOut:function(){a.onMouseMove()}}),i.jsx("div",{className:"_8qbh",children:i.jsx("p",{children:c})})]})};return c}(i.Component);e.exports=a},null);
__d("MessengerGalleryPreview.react",["ix","cx","Image","React","View","asset","gkx","joinClasses"],function(a,b,c,d,e,f,g,h){"use strict";var i=b("React");c=b("React");var j=c.useState;function a(a){var c=j(!1),d=c[0],e=c[1];c=j(!1);var f=c[0],h=c[1];c=b("gkx")("1192938");return i.jsxs(b("View"),{className:b("joinClasses")("_8qi3"+(d?" _8qh8":"")),onMouseEnter:function(){e(!0)},onMouseLeave:function(){e(!1)},children:[i.jsx(b("Image"),{className:"_8q93",source:a.uri,onClick:a.onClick}),i.jsx(b("View"),{className:b("joinClasses")("_8qi5"+(c&&d?" _8qi6":"")+(c&&f?" _8qi7":"")),children:c&&d&&i.jsx(b("Image"),{className:b("joinClasses")("_8qi4"),source:g("511226"),onMouseEnter:function(){h(!0)},onMouseLeave:function(){h(!1)}})})]})}e.exports=a},null);
__d("MessengerGalleryUtils",["MessengerGalleryTypedLogger"],function(a,b,c,d,e,f){"use strict";a={logLatency:function(a,c,d){new(b("MessengerGalleryTypedLogger"))().setEvent(a).setLogLevel(c).setLatency(d).log()}};e.exports=a},null);
__d("MessengerGalleryDetailViewContainer.react",["cx","AsyncRequest","CurrentUser","Link.react","MercuryActionType","MercuryDispatcher","MessengerGalleryDetailViewHeader.react","MessengerGalleryDetailViewSpotlightContainer.react","MessengerGalleryMemoriesViewGrid.react","MessengerGalleryPreview.react","MessengerGalleryUtils","MessengerScrollableArea.react","MessengerSpinner.react","React","XMessagingGalleryController","XMessagingGalleryMemoryController","debounce","gkx","joinClasses"],function(a,b,c,d,e,f,g){"use strict";var h=b("React"),i=[1,2,3,4],j=0;a=function(a){babelHelpers.inheritsLoose(c,a);function c(c){var d;d=a.call(this,c)||this;d.state=d.$7();d.$9=function(a){var c=d.state.cursorTimeStamp;if(c==0||!d.$11()){a();return}var e=Date.now();c=b("XMessagingGalleryController").getURIBuilder().setInt("start_cursor_timestamp_ms",c).getURI();d.$4=new(b("AsyncRequest"))().setURI(c).setMethod("GET").setHandler(function(c){var f=c.getPayload(),g=f.media;d.setState(function(a){var b;a=a.imgMap;b=(b=a.get("gallery"))!=null?b:[];b=b.concat(g).filter(function(a){return a.tag==="gallery"});a.set("gallery",b);return{cursorTimeStamp:f.gallery_cursor,imgMap:a}});b("MessengerGalleryUtils").logLatency("load_gallery_www","info",Date.now()-e);d.$9(a)}).setReadOnly(!0);d.$4.send();return function(){d.$4&&(d.$4.abort(),d.$4=null)}};d.$12=function(){d.setState(function(a){return{imageIndex:a.imageIndex>0?a.imageIndex-1:a.imageIndex}})};d.$13=function(){d.setState(function(a){var b=a.imgMap!=null&&a.tagType!=null?a.imgMap.get(a.tagType):[];return{imageIndex:b&&a.imageIndex<b.length-1?a.imageIndex+1:a.imageIndex}})};d.$14=b("debounce")(function(){var a=d.state.loadingMoreGallery;if(a)return;d.setState({loadingMoreGallery:!0});d.$9(function(){d.setState({loadingMoreGallery:!1})})});c=b("CurrentUser").getID();d.$3=b("MercuryDispatcher").getForFBID(c);d.$6=d.$3.subscribe("update-messages",function(a,c){if(c.actions&&c.actions.length>0){a=c.actions[0].action_type;(a==b("MercuryActionType").REMOVE_MESSAGE||a==b("MercuryActionType").DELETE_MESSAGES)&&d.$8()}});d.$1=d.$1.bind(babelHelpers.assertThisInitialized(d));return d}var d=c.prototype;d.$7=function(){return{cursorTimeStamp:Date.now(),imageIndex:0,loadingMoreGallery:!1,tagType:null,imgMap:new Map(),showViewer:!1}};d.componentDidMount=function(){var a=this;this.setState({cursorTimeStamp:Date.now(),loadingMoreGallery:!0});j=Date.now();this.$9(function(){a.setState({loadingMoreGallery:!1})});this.$10();window.addEventListener("beforeunload",this.$1)};d.componentWillUnmount=function(){b("MessengerGalleryUtils").logLatency("session_duration_www","info",Date.now()-j),this.$6&&this.$6.unsubscribe(),window.removeEventListener("beforeunload",this.$1),this.$2=null,this.$4&&(this.$4.abort(),this.$4=null),this.$4&&(this.$4.abort(),this.$4=null)};d.$1=function(){b("MessengerGalleryUtils").logLatency("session_duration_www","info",Date.now()-j)};d.$8=function(){var a=this;this.$4&&(this.$4.abort(),this.$4=null);this.$4&&(this.$4.abort(),this.$4=null);this.setState(this.$7());this.$9(function(){a.setState({loadingMoreGallery:!1})});this.$10()};d.$10=function(){var a=this;i.forEach(function(c){var d="memory_"+c;c=b("XMessagingGalleryMemoryController").getURIBuilder().setInt("year",c).getURI();a.$5=new(b("AsyncRequest"))().setURI(c).setMethod("GET").setHandler(function(b){var c=b.getPayload();a.setState(function(a){a=a.imgMap;a.set(d,c);return{imgMap:a}})}).setReadOnly(!0);a.$5.send();return function(){a.$5&&(a.$5.abort(),a.$5=null)}})};d.$11=function(){if(!this.$2)return!0;var a=this.$2.getArea();return!a?!1:a.distanceToBottom()<200};d.render=function(){var a=this,c=this.state,d=c.cursorTimeStamp,e=c.imageIndex,f=c.imgMap,g=c.loadingMoreGallery,j=c.showViewer;c=c.tagType;if(f.size==0)return h.jsx("div",{className:"_8q9s",children:h.jsx(b("MessengerSpinner.react"),{size:b("MessengerSpinner.react").large_size})});var k=f.get("gallery");c=c!=null?f.get(c):[];return h.jsxs("div",{children:[c&&e>=0&&e<c.length?h.jsx(b("MessengerGalleryDetailViewSpotlightContainer.react"),{imageIndex:e,imageList:(e=c)!=null?e:[],onNavigateLeft:this.$12,onNavigateRight:this.$13,onCloseViewer:function(){a.setState({showViewer:!1})},showViewer:j}):null,h.jsx(b("MessengerGalleryDetailViewHeader.react"),{}),h.jsx("div",{className:b("joinClasses")("_8q9q _5l-3"),children:h.jsxs(b("MessengerScrollableArea.react"),{height:"100%",ref:function(b){a.$2=b},onScroll:this.$14,children:[h.jsx("div",{className:b("joinClasses")("_8qbg _5l-3"),children:i.map(function(c,d){var e="memory_"+c,g=f.get(e);return!g||g.length===0?null:h.jsx(b("MessengerGalleryMemoriesViewGrid.react"),{coverImage:g[0],onClick:function(){a.setState({imageIndex:0,showViewer:!0,tagType:e})},yearsAgo:c},d)})}),k!=null?k.map(function(c,d){return h.jsx(b("MessengerGalleryPreview.react"),{uri:c.uri,onClick:function(){a.setState({imageIndex:d,showViewer:!0,tagType:"gallery"})}},c.attachment_id)}):null,b("gkx")("1214474")&&d!=0?h.jsx("div",{children:g?h.jsx("div",{className:"_8q9s",children:h.jsx(b("MessengerSpinner.react"),{size:b("MessengerSpinner.react").small_size})}):h.jsx("div",{className:"_19hf",children:h.jsx(b("Link.react"),{href:"#",onClick:this.$9,children:"Load More"})})},"footer"):null]})})]})};return c}(h.Component);e.exports=a},null);