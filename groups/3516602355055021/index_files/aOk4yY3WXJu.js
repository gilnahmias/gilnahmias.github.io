if (self.CavalryLogger) { CavalryLogger.start_js(["t2q+g"]); }

__d("getUpgradedUFI2WritingHelpComposerPlugin_TurnOffWritingHelpMutation.graphql",[],function(a,b,c,d,e,f){"use strict";a=function(){var a=[{kind:"LocalArgument",name:"input",type:"WritingHelpUpdateSettings!",defaultValue:null}],b=[{kind:"LinkedField",alias:null,name:"update_writing_help_settings",storageKey:null,args:[{kind:"Variable",name:"settings",variableName:"input"}],concreteType:"WritingHelpSettings",plural:!1,selections:[{kind:"ScalarField",alias:null,name:"is_enabled",args:null,storageKey:null}]}];return{kind:"Request",fragment:{kind:"Fragment",name:"getUpgradedUFI2WritingHelpComposerPlugin_TurnOffWritingHelpMutation",type:"Mutation",metadata:null,argumentDefinitions:a,selections:b},operation:{kind:"Operation",name:"getUpgradedUFI2WritingHelpComposerPlugin_TurnOffWritingHelpMutation",argumentDefinitions:a,selections:b},params:{operationKind:"mutation",name:"getUpgradedUFI2WritingHelpComposerPlugin_TurnOffWritingHelpMutation",id:"3031414920267044",text:null,metadata:{}}}}();e.exports=a},null);
__d("getUpgradedUFI2WritingHelpComposerPlugin_WritingHelpQuery.graphql",[],function(a,b,c,d,e,f){"use strict";a=function(){var a=[{kind:"LocalArgument",name:"items",type:"[WritingHelpItem!]!",defaultValue:null}],b=[{kind:"LinkedField",alias:null,name:"writing_help",storageKey:null,args:[{kind:"Variable",name:"items",variableName:"items"}],concreteType:"WritingHelpSuggestion",plural:!0,selections:[{kind:"ScalarField",alias:null,name:"is_changed",args:null,storageKey:null},{kind:"ScalarField",alias:null,name:"key",args:null,storageKey:null},{kind:"ScalarField",alias:null,name:"original",args:null,storageKey:null},{kind:"ScalarField",alias:null,name:"prediction",args:null,storageKey:null},{kind:"LinkedField",alias:null,name:"changes",storageKey:null,args:null,concreteType:"WritingHelpSuggestionChanges",plural:!0,selections:[{kind:"ScalarField",alias:null,name:"original_token",args:null,storageKey:null},{kind:"ScalarField",alias:null,name:"original_token_offset",args:null,storageKey:null},{kind:"ScalarField",alias:null,name:"prediction_token",args:null,storageKey:null}]}]}];return{kind:"Request",fragment:{kind:"Fragment",name:"getUpgradedUFI2WritingHelpComposerPlugin_WritingHelpQuery",type:"Query",metadata:null,argumentDefinitions:a,selections:b},operation:{kind:"Operation",name:"getUpgradedUFI2WritingHelpComposerPlugin_WritingHelpQuery",argumentDefinitions:a,selections:b},params:{operationKind:"query",name:"getUpgradedUFI2WritingHelpComposerPlugin_WritingHelpQuery",id:"1218971794893934",text:null,metadata:{}}}}();e.exports=a},null);
__d("XTextRewriteController",["XController"],function(a,b,c,d,e,f){e.exports=b("XController").create("/text_rewrite/rewrite/",{})},null);
__d("UFIFixSuggestionsDetails.react",["ix","cx","fbt","requireCond","AsyncRequest","FDSButton.react","Image.react","Link.react","React","ShimButton.react","TextWithEmoticons.react","URI","cr:1167833","XTextRewriteController","XUIContextualDialog.react","XUIContextualDialogBody.react","XUIContextualDialogTitle.react","XUISpinner.react","asset","cxMargin","emptyFunction","getChunkForContentState"],function(a,b,c,d,e,f,g,h,i){"use strict";var j,k=b("React"),l=b("emptyFunction").thatReturnsTrue,m=/[\\\]:]/g;function n(a,c,d){a=a;if(c!=null){var e=d.getEntity(c);if(e.getType()==="MENTION"){a=a.replace(m,function(a){return"\\"+a});e=e.getData().id;if(/^\d+$/.test(e))return"@["+e+":"+a+"]"}}return b("getChunkForContentState")(a,c,d)}a=function(a){babelHelpers.inheritsLoose(c,a);function c(){var b,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(b=c=a.call.apply(a,[this].concat(e))||this,c.$1=!1,c.$2=null,c.state={selectedChanges:null,suggestionInfos:null,suggestionsChecked:!1,userText:c.props.userText},b)||babelHelpers.assertThisInitialized(c)}c.getDerivedStateFromProps=function(a,b){return a.userText!==b.userText?{selectedChanges:null,suggestionInfos:null,suggestionsChecked:!1,userText:a.userText}:null};var d=c.prototype;d.componentDidMount=function(){this.$3()};d.componentDidUpdate=function(a,b){this.state.suggestionsChecked||this.$3()};d.$4=function(a){var b=this,c,d=[],e=Object.keys(a).map(function(c){var e=a[c];c=e?{blockKey:c,changes:e.changes,originalText:e.original,suggestedText:e.prediction}:null;if(c!=null){d.push(c);if(e&&e.is_changed)return b.$5(c)}return[]});c=(c=[]).concat.apply(c,e);this.setState({selectedChanges:c,suggestionInfos:d,suggestionsChecked:!0})};d.$3=function(){var a=this;if(this.$1)return;this.$1=!0;var c=this.props.composerState.inputState;if(c.__type!=="editor-state-based"){this.setState({selectedChanges:null,suggestionInfos:null,suggestionsChecked:!0});return}c=c.editorState;var d=c.getCurrentContent();c=d.getBlockMap();c=c.map(function(a){var b=a.getText(),c=[];a.findEntityRanges(l,function(e,f){c.push(n(b.slice(e,f),a.getEntityAt(e),d))});return c.join("")});var e=b("XTextRewriteController").getURIBuilder().getURI();new(b("AsyncRequest"))(e).setMethod("POST").setData({input:JSON.stringify(c)}).setHandler(function(b){a.$4(b.payload),a.$1=!1}).setErrorHandler(function(b){a.$1=!1}).send()};d.$6=function(a,b,c){var d="";if(c===b)return d;for(var b=b;b<c;b++)d+=a[b];return d};d.$7=function(a,c){var d=this;a=a.map(function(a){var e=[],f=a.originalText,h=0,j=0,l=i._("Undo"),m=i._("Redo");c.filter(function(b){return b.blockKey===a.blockKey}).forEach(function(c,i){var n=null;if(h<c.startIndex){i=f.slice(h,c.startIndex);e.push(k.jsx(b("TextWithEmoticons.react"),{text:i},"text_"+j));j++}i=c.reverted?g("970169"):g("716591");e.push(k.jsxs("span",{className:"_34dj",children:[k.jsx(b("TextWithEmoticons.react"),{ref:function(a){return n=a},text:c.reverted?c.originalValue:c.changeValue}),k.jsx(b("XUIContextualDialog.react"),{autoFocus:!1,contextRef:function(){return n},hoverContextRef:function(){return n},label:c.reverted?m:l,position:"below",children:k.jsxs(b("ShimButton.react"),{className:"_72_- _2pi2 _2pi8",onClick:function(){return d.$8(a,c)},children:[k.jsx(b("Image.react"),{src:i}),k.jsx("span",{className:"_8bkx _2pir",children:c.reverted?m:l})]})})]},"highlight_"+j));j++;h=c.startIndex+c.changeCount});var n=f.slice(h);n&&e.push(k.jsx(b("TextWithEmoticons.react"),{text:n},"text_"+j));return k.jsx("div",{className:"_8bl2",children:e},"suggestion_"+a.blockKey)});return k.jsx("span",{children:a})};d.$8=function(a,c){this.setState(function(d,e){e=d.suggestionInfos;if(e&&d.selectedChanges){c.reverted=!c.reverted;e=c.reverted?"redo_change":"undo_change";new(b("cr:1167833"))().setAction(e).addToExtraData("interface_type","suggestions_details").addToExtraData("original_token",c.originalValue).addToExtraData("prediction_token",c.changeValue).addToExtraData("original_text",a.originalText).addToExtraData("prediction_text",a.suggestedText).log();return{selectedChanges:d.selectedChanges}}})};d.$5=function(a){var b=this,c=[];a.changes.forEach(function(d){var e,f={};f.blockKey=a.blockKey;f.originalValue=d.original_token||"";f.changeValue=d.prediction_token||"";f.changeCount=((e=d.original_token)==null?void 0:e.length)||0;f.suggestionInfo=a;f.startIndex=b.$6(a?Array.from(a.originalText):[],0,d.original_token_offset||0).length;c.push(f)});return c};d.render=function(){var a=this,c=this.state.suggestionsChecked&&!this.state.suggestionInfos?null:k.jsx(b("FDSButton.react"),{label:!this.state.suggestionsChecked&&!this.props.isInitialCheck?i._("Refreshing..."):i._("Accept"),isDisabled:!this.state.suggestionsChecked,margin:"_3-9a",onClick:function(){if(a.state.suggestionInfos){var b,c=a.state.selectedChanges;c&&(b=c.filter(function(a){return!a.reverted}));a.props.onAccept(b)}else a.props.onAccept(null)},use:"primary"});this.props.hasStaleSuggestions&&(c=k.jsx(b("FDSButton.react"),{label:i._("Refresh"),margin:"_3-9a",onClick:this.props.onRefresh,use:"primary"}));var d=k.jsx(b("XUISpinner.react"),{});this.state.suggestionsChecked&&(this.state.suggestionInfos&&this.state.selectedChanges&&this.state.selectedChanges.length?d=this.$7(this.state.suggestionInfos,this.state.selectedChanges):d=i._("No suggestions"));var e=new(j||(j=b("URI")))("/settings");e.addQueryData("tab","language");return k.jsxs("div",{className:"_2pid",children:[k.jsxs("div",{className:"_34dl _3-95",children:[k.jsx("span",{className:"_34e_",children:i._("More writing help")}),k.jsx("span",{className:"_34f0 _3-99",ref:function(b){return a.$2=b},children:k.jsx(b("Image.react"),{src:g("534165")})}),k.jsx("span",{className:"_74-e"}),k.jsx(b("Link.react"),{className:"_74_s",href:e,children:i._("Settings")}),k.jsxs(b("XUIContextualDialog.react"),{autoFocus:!1,contextRef:function(){return a.$2},hoverContextRef:function(){return a.$2},position:"below",width:b("XUIContextualDialog.react").WIDTH.NORMAL,children:[k.jsx(b("XUIContextualDialogTitle.react"),{children:i._("Writing help")}),k.jsx(b("XUIContextualDialogBody.react"),{children:i._("This tool is not a traditional spellchecker, but is instead designed to suggest less common changes. For example, it can highlight words that sound similar but have different meanings.")})]})]}),k.jsx("div",{className:"_34f1 _2ph-",children:d}),k.jsxs("div",{className:"_34f2 _3-8x",id:this.props.rapidFeedbackSelectorID,children:[k.jsx(b("FDSButton.react"),{isDisabled:!this.state.suggestionsChecked,label:i._("Ignore"),onClick:this.props.onCancel}),c]})]})};return c}(k.Component);e.exports=a},null);
__d("Suggestion.react",["fbt","FlexLayout.react","Link.react","React","stylex"],function(a,b,c,d,e,f,g){"use strict";var h=b("React");function a(a){a=a.word;return h.jsxs(b("FlexLayout.react"),{direction:"vertical",children:[h.jsx("div",{className:"c62b7rha jp84ubcb rl5vm4r3",children:a}),h.jsx("div",{children:g._("{=Replace}",[g._param("=Replace",h.jsx(b("Link.react"),{children:g._("Replace")}))])})]})}e.exports=a},null);
__d("WritingHelpDialog",["cx","DialogX","LayerAutoFocusReact","LayerDestroyOnHide","LayerFadeOnHide","LayerFadeOnShow","LayerHideOnBlur","LayerHideOnEscape","LayerRefocusOnHide","React","XUIDialogBody.react","XUIDialogButton.react","XUIDialogCancelButton.react","XUIDialogFooter.react","XUIDialogOkayButton.react","XUIDialogTitle.react","joinClasses","uniqueID"],function(a,b,c,d,e,f,g){"use strict";var h=b("React"),i=445,j={showConfirm:function(a,c,d,e){var f=!1,g=h.jsx(b("XUIDialogOkayButton.react"),{action:"cancel",className:e&&e.autofocusConfirm?"autofocus":"",onClick:function(){f=!0},use:"confirm"});e&&e.confirmBtnTxt!=null&&(g=h.jsx(b("XUIDialogButton.react"),{action:"cancel",className:b("joinClasses")(e&&e.autofocusConfirm?"autofocus":"","_2z1w"),label:e.confirmBtnTxt,onClick:function(){f=!0},use:"confirm"}));var i=h.jsx(b("XUIDialogCancelButton.react"),{onClick:function(){f=!1}});if(e&&e.cancelBtnTxt!=null){var k=e.cancelBtnProps;i=h.jsx(b("XUIDialogButton.react"),babelHelpers["extends"]({action:"button",label:e.cancelBtnTxt,onClick:function(){f=!1}},k))}k=h.jsxs("div",{children:[i,g]});function l(){d&&d(f)}return j.showEx(a,c,k,l,e)},showEx:function(a,c,d,e,f){f===void 0&&(f={});var g=[b("LayerDestroyOnHide"),b("LayerFadeOnShow"),b("LayerFadeOnHide"),b("LayerHideOnEscape"),b("LayerRefocusOnHide")];f.hideOnBlur!==!1&&g.push(b("LayerHideOnBlur"));f.useReactFocusBehavior===!0&&g.push(b("LayerAutoFocusReact"));g={addedBehaviors:g,causalElement:f.causalElement,width:f.width!=null?f.width:i,xui:!0};var j=c;if(j!=null){var k=b("uniqueID")();g.titleID=k;j=h.jsx(b("XUIDialogTitle.react"),{id:k,showCloseButton:f.showCloseButton!==!1,children:c})}k=d;k!=null&&(k=h.jsx(b("XUIDialogFooter.react"),{"data-testid":void 0,leftContent:f.leftContent,children:d}));c=h.jsxs("div",{children:[j,h.jsx(b("XUIDialogBody.react"),{children:a}),k]});f=new(b("DialogX"))(g,c);e&&f.subscribe("hide",e);f.show()}};e.exports=j},null);
__d("WritingHelp",["fbt","Link.react","React","UFI2NUXConfig","WritingHelpDialog","XSettingsController","XWorkWebHelpDelegateController"],function(a,b,c,d,e,f,g){"use strict";var h=b("React"),i={HELP_CENTER_PAGE_ID:635529530609611,HIGHLIGHT_SUGGESTION_NUX_ID:7566,INTRO_NUX_ID:7670,OPT_IN_NUX_ID:7667,shouldShowIntroNUX:b("UFI2NUXConfig").UFI2WritingAssistanceIntroNUX!=null,shouldShowOptInNUX:b("UFI2NUXConfig").UFI2WritingAssistanceOptInNUX!=null,shouldShowSuggestionHighlightNUX:b("UFI2NUXConfig").UFI2WritingHelpNUX!=null,showOptInDialog:function(a){var c=b("XWorkWebHelpDelegateController").getURIBuilder().setInt("id",i.HELP_CENTER_PAGE_ID).getURI(),d=g._("Turn on Writing Assistance?");c=h.jsxs(h.Fragment,{children:[g._("If you turn Writing Assistance on, we'll analyze your text and provide grammar and spelling suggestions in real time."),h.jsx("br",{}),h.jsx("br",{}),g._("We may temporarily store what you've typed or the suggestions you've accepted to help improve this feature."),h.jsx("br",{}),h.jsx("br",{}),g._("To learn more, visit the {=Help Center.}",[g._param("=Help Center.",h.jsx(b("Link.react"),{href:c,target:"_blank",children:g._("Help Center.")}))])]});var e=g._("Cancel"),f=g._("Turn On");b("WritingHelpDialog").showConfirm(c,d,a,{autofocusConfirm:!0,cancelBtnTxt:e,confirmBtnTxt:f})},showOptOutConfirmationDialog:function(){var a=b("XSettingsController").getURIBuilder().setString("tab","language").setString("section","writing_help").getURI(),c=g._("Turn Writing Assistance Off"),d=g._("You can turn these suggestions on anytime by visiting your Language Settings."),e=g._("Manage Settings"),f=g._("OK");b("WritingHelpDialog").showConfirm(d,c,null,{autofocusConfirm:!0,cancelBtnProps:{href:{url:a},target:"_blank"},cancelBtnTxt:e,confirmBtnTxt:f})},showOptOutDialog:function(a){var c=b("XSettingsController").getURIBuilder().setString("tab","language").setString("section","writing_help").getURI(),d=g._("Turn Writing Assistance Off?");c=g._("When you turn Writing Assistance off, you'll no longer receive grammar and spelling suggestions from Facebook. You'll still see any suggestions provided by your browser. You can turn Writing Assistance on or off anytime by visiting your {=Language Settings}.",[g._param("=Language Settings",h.jsx(b("Link.react"),{href:c,target:"_blank",children:g._("Language Settings")}))]);var e=g._("Cancel"),f=g._("OK");b("WritingHelpDialog").showConfirm(c,d,a,{autofocusConfirm:!0,cancelBtnTxt:e,confirmBtnTxt:f})}};e.exports=i},null);
__d("XHelpdeskWorkplaceHomeController",["XController"],function(a,b,c,d,e,f){e.exports=b("XController").create("/work/helpdesk/{tab}/",{tab:{type:"Enum",defaultValue:"your_cases",enumType:1},q:{type:"String"},sort_user:{type:"Enum",enumType:1},env:{type:"String"}})},null);
__d("WritingAssistanceIntroNUX.react",["fbt","Link.react","React","UFI2NUXConfig","WritingHelp","XHelpdeskWorkplaceHomeController","stylex"],function(a,b,c,d,e,f,g){"use strict";var h=b("React");function a(a){var c=a.contextRef,d=a.onDismiss;a=a.onTurnOff;var e=b("XHelpdeskWorkplaceHomeController").getURIBuilder().setEnum("tab","your_cases").getURI();return b("UFI2NUXConfig").UFI2WritingAssistanceIntroNUX?h.jsx(b("UFI2NUXConfig").UFI2WritingAssistanceIntroNUX,{alignment:"left",contextRef:c,nuxID:b("WritingHelp").INTRO_NUX_ID,onCloseButtonClick:d,shouldShow:!0,width:"wide",children:g._("Now as you type, we'll analyze your text to provide grammar and spelling suggestions in real time. You can {=Turn Off} Writing Assistance or learn more in our {=Help Center}.",[g._param("=Turn Off",h.jsx("span",{className:"lk9g6eiy n05y2jgg",onClick:a,role:"link",tabIndex:0,children:g._("Turn Off")})),g._param("=Help Center",h.jsx(b("Link.react"),{href:e,target:"_blank",children:g._("Help Center")}))])}):null}e.exports=a},null);
__d("WritingAssistanceOptInNUX.react",["fbt","React","UFI2NUXConfig","WritingHelp","stylex"],function(a,b,c,d,e,f,g){"use strict";var h=b("React");c=b("React");var i=c.useState;function a(a){var c=a.contextRef,d=a.onOptIn;a=a.shouldShow;var e=i(!0),f=e[0],j=e[1];return b("UFI2NUXConfig").UFI2WritingAssistanceOptInNUX?h.jsx(b("UFI2NUXConfig").UFI2WritingAssistanceOptInNUX,{alignment:"left",contextRef:c,nuxID:b("WritingHelp").OPT_IN_NUX_ID,onCloseButtonClick:function(){b("UFI2NUXConfig").UFI2WritingAssistanceOptInNUX=null},shouldShow:f&&a,children:g._("{=Turn on} Writing Assistance to get grammar and spelling suggestions when you comment on posts",[g._param("=Turn on",h.jsx("span",{className:"lk9g6eiy n05y2jgg",onClick:function(){j(!1),b("UFI2NUXConfig").UFI2WritingAssistanceOptInNUX=null,b("WritingHelp").showOptInDialog(function(a){a&&d()})},role:"link",tabIndex:0,children:g._("Turn on")}))])}):null}e.exports=a},null);
__d("WritingAssistanceSuggestionHighlightNUX.react",["fbt","React","UFI2NUXConfig","WritingHelp"],function(a,b,c,d,e,f,g){"use strict";var h=b("React");function a(a){a=a.contextRef;return b("UFI2NUXConfig").UFI2WritingHelpNUX?h.jsx(b("UFI2NUXConfig").UFI2WritingHelpNUX,{alignment:"left",contextRef:a,nuxID:b("WritingHelp").HIGHLIGHT_SUGGESTION_NUX_ID,shouldShow:!0,children:g._("Hover over highlighted words to see grammar or spelling suggestions")}):null}e.exports=a},null);
__d("WritingHelpSuggestionSpan.react",["fbt","requireCond","ClickableArea.react","ContextualDialogArrow","FlexLayout.react","PopoverMenu.react","React","ReactXUIMenu","Suggestion.react","WritingAssistanceSuggestionHighlightNUX.react","cr:1167833","WritingHelp","XUIContextualDialog.react","XUIDotsButton.react","XWorkWebHelpDelegateController","stylex"],function(a,b,c,d,e,f,g){"use strict";var h=b("React");c=b("React");var i=c.useEffect,j=c.useRef,k=c.useState;function a(a){var c=a.children,d=a.contentState,e=a.entityKey,f=a.offsetKey;a=babelHelpers.objectWithoutPropertiesLoose(a,["children","contentState","entityKey","offsetKey"]);var l=j(null),m=k(!1),n=m[0],o=m[1];i(function(){b("WritingHelp").shouldShowSuggestionHighlightNUX&&(b("WritingHelp").shouldShowSuggestionHighlightNUX=!1,o(!0))},[l,o]);if(e==null)return null;m=d.getEntity(e);d=m.getData();e=d.acceptSuggestion;var p=d.onSuggestionToggled;m=d.onTurnOffWritingHelp;var q=d.replacementInfo;d=q.changeValue;m=h.jsxs(b("ReactXUIMenu"),{children:[h.jsx(b("ReactXUIMenu").Item,{"data-testid":void 0,onClick:m,children:g._("Turn Off Writing Assistance")}),h.jsx(b("ReactXUIMenu").Item,{"data-testid":void 0,href:b("XWorkWebHelpDelegateController").getURIBuilder().setInt("id",b("WritingHelp").HELP_CENTER_PAGE_ID).getURI(),target:"_blank",children:g._("Learn More")})]});var r=g._("Options"),s=function(a){p(),new(b("cr:1167833"))().setAction("toggle_suggestion").addToExtraData("interface_type","inline_composer").addToExtraData("suggestion_shown",a.toString()).addToExtraData("original_token",q.originalValue).addToExtraData("prediction_token",q.changeValue).log()};n=n&&l.current?h.jsx(b("WritingAssistanceSuggestionHighlightNUX.react"),{contextRef:function(){return l.current}}):null;return h.jsxs("span",babelHelpers["extends"]({},a,{className:"tmn3stou tmhiu4ce mnkgsxqk tt4d589f s3nkh0li","data-offset-key":f,"data-testid":void 0,children:[h.jsx("span",{ref:l,children:c}),h.jsx(b("XUIContextualDialog.react"),{alignment:"center",autoFocus:!1,contextRef:function(){return l.current},"data-testid":void 0,hoverContextRef:function(){return l.current},hoverHideDelay:250,hoverShowDelay:500,label:q.changeValue,onToggle:s,position:"above",children:h.jsx(b("FlexLayout.react"),{align:"center",className:"dtup7xkc e8umytep qy8zhr6p px367esf",children:h.jsxs(h.Fragment,{children:[h.jsx(b("ClickableArea.react"),{onClick:e,children:h.jsx("div",{"aria-label":"Change to "+d,className:"qy8zhr6p n05y2jgg","data-testid":void 0,children:h.jsx(b("Suggestion.react"),{word:d})})}),h.jsx("div",{className:"t0fmm8kf siwjl7sh snu8thy7 gp8nioim",children:h.jsx(b("PopoverMenu.react"),{"data-testid":void 0,layerBehaviors:[b("ContextualDialogArrow")],menu:m,children:h.jsx(b("XUIDotsButton.react"),{label:r})})})]})})}),n]}))}e.exports=a},null);
__d("getUpgradedUFI2WritingHelpComposerPlugin",["cx","requireCond","ContentStateStore","DraftEditorUtils","DraftModifier","EditorState","React","RelayModern","SelectionState","UFI2ToggleWritingHelpComposerAction.react","UFIFixSuggestionsDetails.react","WritingAssistanceIntroNUX.react","WritingAssistanceOptInNUX.react","cr:1167833","WritingHelp","WritingHelpSuggestionSpan.react","createCancelableFunction","debounce","getEntityMatcher","getMentionsTextForContentState","installUFI2ComposerInputDecorators","promiseDone","qex","throttle","uniqueID","getUpgradedUFI2WritingHelpComposerPlugin_WritingHelpQuery.graphql","getUpgradedUFI2WritingHelpComposerPlugin_TurnOffWritingHelpMutation.graphql"],function(a,b,c,d,e,f,g){"use strict";var h,i,j=b("React"),k=b("RelayModern").commitMutation,l=b("RelayModern").fetchQuery;b("RelayModern").graphql;var m=1e4,n=1e3,o=1,p=1e3,q=h!==void 0?h:h=b("getUpgradedUFI2WritingHelpComposerPlugin_WritingHelpQuery.graphql"),r=i!==void 0?i:i=b("getUpgradedUFI2WritingHelpComposerPlugin_TurnOffWritingHelpMutation.graphql"),s="WRITING_HELP",t={component:b("WritingHelpSuggestionSpan.react"),strategy:b("getEntityMatcher")(function(a){return a.getType()===s})};function a(a){var c=b("qex")._("1027274")||a.defaultInterfaceType,d=b("ContentStateStore")(),e=j.createRef(),f=b("uniqueID")(),g=b("uniqueID")();function h(){var a=b("createCancelableFunction")(y),c,d=b("debounce")(function(b,d){c!==b&&(c=b,a(b,d))},n),e=b("throttle").acrossTransitionsWithBlocking(function(b,d){c!==b&&(c=b,a(b,d))},m);function f(a,b){d(a,b),e(a,b)}f.cancel=a.cancel;return f}var i=h(),u=function(c,e,f){f||(i.cancel(),C(c));function g(){e({isEnabled:f});if(f){var a=c.inputProps.composerState.inputState;if(a.__type==="editor-state-based"){a=a.editorState;a=a.getCurrentContent();a=d.diff(a);a!=null&&y(c,e)}}else b("WritingHelp").showOptOutConfirmationDialog()}k(a.environment,{mutation:r,onCompleted:g,variables:{input:{is_enabled:f}}})};function v(a,b,c){var d="";if(c===b)return d;for(var b=b;b<c;b++)d+=a[b];return d}function w(a){var b=[];a.changes.forEach(function(c){var d,e={};e.blockKey=a.blockKey;e.originalValue=c.original_token||"";e.changeValue=c.prediction_token||"";e.changeCount=((d=c.original_token)==null?void 0:d.length)||0;e.suggestionInfo=a;e.startIndex=v(a?Array.from(a.originalText):[],0,c.original_token_offset||0).length;b.push(e)});return b}function x(a,b,c){var d=[];c.forEach(function(a){if(a!=null&&a.is_changed===1&&a.key!=void 0){a=w({blockKey:a.key,changes:a.changes.map(function(a){var b=a.prediction_token,c=a.original_token;a=a.original_token_offset;return b==null||c==null||a==null?null:{original_token:c,original_token_offset:a,prediction_token:b,prediction_token_offset:0}}).filter(Boolean),originalText:a.original||"",suggestedText:a.prediction||""});d.push.apply(d,a)}});C(a,c,d);D(a,b,d)}function y(c,e){var f=c.inputProps.composerState.inputState;if(f.__type!=="editor-state-based")return;f=d.getLastDiff();if(f==null)return;var g=[];f.getBlockMap().forEach(function(a){var b=a.getKey();a=a.getText();a.length>=o&&a.length<=p&&g.push({key:b,text:a})});f.accept();g.length>0&&b("promiseDone")(l(a.environment,q,{items:g}).then(function(a){x(c,e,a.writing_help)}))}function z(a){a=a.inputProps.composerState.inputState;switch(a.__type){case"editor-state-based":return b("getMentionsTextForContentState")(a.editorState.getCurrentContent());case"plain-text":return a.text}return""}function A(a,c){a.inputProps.onComposerStateChange(function(a){var e=a.inputState;if(e.__type!=="editor-state-based")return a;var f=e.editorState,g=f.getSelection();f=b("EditorState").set(f,{allowUndo:!1});f=c(f);f=b("EditorState").set(f,{allowUndo:!0});f=b("EditorState").acceptSelection(f,g);d.update(f.getCurrentContent());return babelHelpers["extends"]({},a,{inputState:babelHelpers["extends"]({},e,{editorState:f})})})}function B(a,c,d){A(a,function(a){var e=a.getCurrentContent(),f=e.getEntity(d);f=f.getData();f=f.replacementInfo;var g=b("DraftEditorUtils").getEntityRange(a,d,s);if(g==null)return a;var h=e.getBlockForKey(c);if(h!=null&&h.getLength()<g.end)return a;h=b("SelectionState").createEmpty(c).merge({anchorOffset:g.start,focusOffset:g.end});e=b("DraftModifier").replaceText(e,h,f.changeValue);return b("EditorState").push(a,e,f.changeValue.length>0?"insert-characters":"remove-range")})}function C(a,c,d){var e;c!=null&&(e=c.map(function(a){return a.key}).filter(Boolean));A(a,function(a){var c=a.getCurrentContent();c=b("DraftEditorUtils").filterEntityRanges(function(c,f,g,h){if(f.getType()!==s||e!=null&&!e.includes(h.getKey()))return!0;if(d==null)return!1;c=b("DraftEditorUtils").getEntityRange(a,g,s);if(c!=null){f=d.find(function(a){a=a.blockKey;return a===h.getKey()});if(f!=null&&(c.start===f.startIndex&&c.end===f.startIndex+f.changeCount))return!0}return!1},c);return b("EditorState").push(a,c,"apply-entity")})}function D(a,d,e){A(a,function(f){var g=f;f=g.getCurrentContent();var h=function(){if(j){if(k>=i.length)return"break";l=i[k++]}else{k=i.next();if(k.done)return"break";l=k.value}var e=l;f=g.getCurrentContent();var h=e.blockKey,m=f.getBlockForKey(h);if(m==null)return"continue";var n=m.getText().substr(e.startIndex);n=n.match(/\w*/g);if(n!=null&&n[0]!==e.originalValue)return"continue";n={};var o=f.createEntity(s,"MUTABLE",n),p=o.getLastCreatedEntityKey();Object.assign(n,{acceptSuggestion:function(){B(a,h,p),new(b("cr:1167833"))().setAction("accept_suggestion").addToExtraData("interface_type",c).addToExtraData("original_token",e.originalValue).addToExtraData("prediction_token",e.changeValue).log()},onSuggestionToggled:function(){a.inputProps.composerState.usedWritingHelpToCompose!==!0&&a.inputProps.onComposerStateChange(function(a){return babelHelpers["extends"]({},a,{usedWritingHelpToCompose:!0})})},onTurnOffWritingHelp:function(){return u(a,d,!1)},replacementInfo:e});n=e.startIndex+e.changeCount;m.getLength()<n&&(n=m.getLength());n=b("SelectionState").createEmpty(h).merge({anchorOffset:e.startIndex,focusOffset:n,hasFocus:!1});m=b("DraftEditorUtils").getSelectionEntity(m,n);if(m!=null)return"continue";m=b("DraftModifier").applyEntity(o,n,p);g=b("EditorState").push(g,m,"apply-entity")};_loop:for(var i=e,j=Array.isArray(i),k=0,i=j?i:i[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var l,m=h();switch(m){case"break":break _loop;case"continue":continue}}return g})}function E(a,c){a.inputProps.onComposerStateChange(function(a){var d=a.inputState,e=c.sort(function(a,b){return b.startIndex-a.startIndex});if(d.__type!=="editor-state-based")return a;var f=d.editorState,g=f.getCurrentContent();for(var e=e,h=Array.isArray(e),i=0,e=h?e:e[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var j;if(h){if(i>=e.length)break;j=e[i++]}else{i=e.next();if(i.done)break;j=i.value}j=j;var k=b("SelectionState").createEmpty(j.blockKey).merge({anchorOffset:j.startIndex,focusOffset:j.startIndex+j.changeCount});g=b("DraftModifier").replaceText(g,k,j.changeValue);f=b("EditorState").push(f,g,j.changeValue.length>0?"insert-characters":"remove-range")}if(d.__type==="editor-state-based")return babelHelpers["extends"]({},a,{inputState:babelHelpers["extends"]({},d,{editorState:f})})})}return{componentDidMount:function(a){a.subscriptionsHandler.addSubscriptions({remove:function(){i.cancel()}})},componentDidUpdate:function(a,e,f){if(!e.isEnabled)return;var g=a.inputProps.composerState.inputState;if(c==="inline_composer"&&e.isActive&&g.__type==="editor-state-based"){e=g.editorState;var h=e.getCurrentContent();g=d.diff(h);g!=null&&(A(a,function(a){var c=a.getSelection();if(c.isCollapsed()){var d=a,e=c.getAnchorKey();c=c.getAnchorOffset();var f=h.getBlockForKey(e),g=c-2;g>=0&&(d=b("DraftEditorUtils").removeEntityAtOffset(d,e,g,s));g=c+1;g<=f.getLength()&&(d=b("DraftEditorUtils").removeEntityAtOffset(d,e,g,s));return d}return a}),i(a,f))}},getUserText:function(a){return z(a)},onDisable:function(a){i.cancel(),C(a)},onEnable:function(a,b){d.reset(),i=h(),i(a,b)},render:function(k,l,m,n,o){k.subscriptionsHandler;var p=babelHelpers.objectWithoutPropertiesLoose(k,["subscriptionsHandler"]),q=function(a){a!=null&&E(k,a),m({isActive:!1}),new(b("cr:1167833"))().setAction("action_clicked").setValue("accept").addToExtraData("interface_type",c).log()},r=function(){m({isInitialSuggestionCheck:!1,userText:z(k)}),new(b("cr:1167833"))().setAction("action_clicked").setValue("refresh").addToExtraData("interface_type",c).log()},s=function(){m({isActive:!1}),new(b("cr:1167833"))().setAction("action_clicked").setValue("ignore").addToExtraData("interface_type",c).log()},v=function(a){l.isActive?(i.cancel(),C(k)):(d.reset(),i=h()),o(a)},w=[].concat(k.actions);a.isAutoEnabled||w.push(j.jsx(b("UFI2ToggleWritingHelpComposerAction.react"),{hasText:z(k).length>0,isActive:l.isActive,onClick:v},"writingHelpComposerAction"));v=!l.isEnabled&&l.showOptInNUX&&e.current!=null?j.jsx(b("WritingAssistanceOptInNUX.react"),{contextRef:function(){return e.current},onOptIn:function(){return u(k,m,!0)},shouldShow:!0}):null;var x=l.showIntroNUX&&e.current!=null?j.jsx(b("WritingAssistanceIntroNUX.react"),{contextRef:function(){return e.current},onDismiss:function(){return m({showIntroNUX:!1})},onTurnOff:function(){m({showIntroNUX:!1}),b("WritingHelp").showOptOutDialog(function(a){a&&u(k,m,!1)})}}):null;return j.jsxs("div",{className:"_73_f",id:g,ref:e,children:[j.jsx(n,babelHelpers["extends"]({},p,{actions:w,inputProps:babelHelpers["extends"]({},p.inputProps,{composerState:b("installUFI2ComposerInputDecorators")(p.inputProps.composerState,t),onFocus:function(){var a;m({showIntroNUX:(a=b("WritingHelp")).shouldShowIntroNUX,showOptInNUX:a.shouldShowOptInNUX});a.shouldShowIntroNUX=!1;a.shouldShowOptInNUX=!1}})})),l.isActive&&(c==null||c==="suggestions_details")?j.jsx(b("UFIFixSuggestionsDetails.react"),{composerState:k.inputProps.composerState,hasStaleSuggestions:l.userText!==z(k),isInitialCheck:l.isInitialSuggestionCheck,onAccept:q,onCancel:s,onRefresh:r,rapidFeedbackSelectorID:f,userText:l.userText}):null,v,x]})}}}e.exports=a},null);