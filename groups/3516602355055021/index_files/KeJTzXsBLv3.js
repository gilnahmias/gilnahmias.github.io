if (self.CavalryLogger) { CavalryLogger.start_js(["wBQ2t"]); }

__d("SmartComposeTypeaheadHelperQuery.graphql",[],function(a,b,c,d,e,f){"use strict";a=function(){var a=[{kind:"LocalArgument",name:"queryParams",type:"AssistantSmartComposeParams!",defaultValue:null}],b=[{kind:"LinkedField",alias:null,name:"typeahead_list",storageKey:null,args:[{kind:"Variable",name:"query_params",variableName:"queryParams"}],concreteType:"AssistantSmartComposeCandidate",plural:!0,selections:[{kind:"ScalarField",alias:null,name:"confidence",args:null,storageKey:null},{kind:"ScalarField",alias:null,name:"typeahead",args:null,storageKey:null}]}];return{kind:"Request",fragment:{kind:"Fragment",name:"SmartComposeTypeaheadHelperQuery",type:"Query",metadata:null,argumentDefinitions:a,selections:b},operation:{kind:"Operation",name:"SmartComposeTypeaheadHelperQuery",argumentDefinitions:a,selections:b},params:{operationKind:"query",name:"SmartComposeTypeaheadHelperQuery",id:"2326980770744887",text:null,metadata:{}}}}();e.exports=a},null);
__d("SmartComposeCandidatesGeneratedFalcoEvent",["FalcoLoggerInternal"],function(a,b,c,d,e,f){"use strict";a=b("FalcoLoggerInternal").create("smart_compose_candidates_generated");e.exports=a},null);
__d("SmartComposeMatchingSuggestionFalcoEvent",["FalcoLoggerInternal"],function(a,b,c,d,e,f){"use strict";a=b("FalcoLoggerInternal").create("smart_compose_matching_suggestion");e.exports=a},null);
__d("SmartComposeSuggestionClickedFalcoEvent",["FalcoLoggerInternal"],function(a,b,c,d,e,f){"use strict";a=b("FalcoLoggerInternal").create("smart_compose_suggestion_clicked");e.exports=a},null);
__d("SmartComposeSuggestionDisplayedFalcoEvent",["FalcoLoggerInternal"],function(a,b,c,d,e,f){"use strict";a=b("FalcoLoggerInternal").create("smart_compose_suggestion_displayed");e.exports=a},null);
__d("SmartComposeTypeaheadHelper",["CancelablePromise","React","RelayModern","SmartComposeCandidatesGeneratedFalcoEvent","SmartComposeMatchingSuggestionFalcoEvent","SmartComposeSuggestionClickedFalcoEvent","SmartComposeSuggestionDisplayedFalcoEvent","promiseDone","stylex","SmartComposeTypeaheadHelperQuery.graphql"],function(a,b,c,d,e,f){"use strict";var g,h=b("React"),i=b("RelayModern").fetchQuery;b("RelayModern").graphql;var j=7,k=100,l=g!==void 0?g:g=b("SmartComposeTypeaheadHelperQuery.graphql");a=function(){function a(a,b,c){var d=this;this.$1=null;this.$2="";this.$3="";this.$4="";this.$5="";this.$6=null;this.$7=new Set();this.$8=[];this.$11=null;this.$13={end:0,start:0};this.$15=new Date();this.$16=-1;this.$17=-1;this.$9=a;this.$12=b;this.$10=c;this.$14={component:function(a){var b=d.getSuggestion();return h.jsxs(h.Fragment,{children:[a.children,b.length>0&&h.jsx("span",{className:"ll82wnt6 g3x53x41",children:b})]})},strategy:function(a,b,c){if(d.getSuggestion().length===0)return;a=d.$5.length;b(a-1,a)}}}var c=a.prototype;c.updateTypeSpeed=function(){var a=new Date();this.$16=a-this.$15;this.$15=a;return this};c.setEnteredText=function(a){a!==this.$5&&(this.$4=this.$5,this.$5=a,this.$18(),this.$19());return this};c.setCursorPosition=function(a,b){(this.$13.start!==a||this.$13.end!==b)&&(this.$13={end:b,start:a},this.$18());return this};c.getSuggestion=function(){var a;return(a=(a=this.$6)==null?void 0:a.filteredText)!=null?a:""};c.isCursorAtEnd=function(){var a=this.$13,b=a.start;a=a.end;return b===a&&b===this.$5.length};c.isDeleting=function(){return this.$5.length<this.$4.length};c.getDraftDecorator=function(){return this.$14};c.onSuggestionChange=function(a){var b=this;this.$11=a;return{cancel:function(){b.$11=null}}};c.logSuggestionInserted=function(){var a=this,c=this.$6;if(c==null)return;b("SmartComposeSuggestionClickedFalcoEvent").log(function(){return{complete_text:c.candidate.text,confidence:c.candidate.confidence,processing_time:c.candidate.processingTime,suggestion_text:c.filteredText,surface:a.$9,type_speed:a.$17}})};c.reset=function(){this.$1&&this.$1.cancel(),this.$1=null,this.$11=null};c.$18=function(){var a,b=this.$20();if((b==null?void 0:b.filteredText)!==((a=this.$6)==null?void 0:a.filteredText)){this.$6=b;this.$11&&this.$11((a=b==null?void 0:b.filteredText)!=null?a:"")}};c.$20=function(a){var c=this;a=a||this.$8;if(a.length===0||this.$5.indexOf(this.$3)<0||this.isDeleting()||!this.isCursorAtEnd())return null;var d=this.$5.substring(this.$3.length,this.$5.length).toLowerCase();if(d.length===0)return null;var e=a.find(function(a){return a.text.toLowerCase().indexOf(d)===0});if(e==null)return null;if(e.text.length<=d.length&&this.$7.has(e.text)){b("SmartComposeMatchingSuggestionFalcoEvent").log(function(){return{confidence:e.confidence,suggestion_text:e.text,suggestion_text_length:e.text.length,surface:c.$9,type_speed:c.$16}});return null}if(!this.$7.has(e.text)&&(e.text.length-d.length<j||this.$16!==-1&&this.$16<k))return null;var f={candidate:babelHelpers["extends"]({},e),filteredText:e.text.substring(d.length,e.text.length)};this.$7.has(e.text)||(this.$7.add(e.text),this.$17=this.$16,b("SmartComposeSuggestionDisplayedFalcoEvent").log(function(){return{complete_text:e.text,confidence:e.confidence,processing_time:e.processingTime,suggestion_text:f.filteredText,surface:c.$9,type_speed:c.$17}}));return f};c.$19=function(){var a=this;if(this.$5.trim()===""||!/[^\s]+\s$/.test(this.$5)||this.$2===this.$5||this.$3===this.$5||this.$5.length<this.$4.length||this.$6!=null)return;var c=Date.now();this.$2=this.$5;this.$1&&this.$1.cancel();this.$1=new(b("CancelablePromise"))(i(this.$12,l,{queryParams:{feedback_id:this.$10,surface:this.$9,text:this.$5}}));b("promiseDone")(this.$1.getPromise(),function(d){var e=Date.now()-c,f=(d.typeahead_list&&d.typeahead_list.length>0?d.typeahead_list:[]).map(function(a){return{confidence:Math.round(1e4*a.confidence),processingTime:e,text:a.typeahead}});f.length>0&&(a.$6==null||a.$20(f)!=null)&&(a.$3=a.$2,a.$8=f,a.$7=new Set(),b("SmartComposeCandidatesGeneratedFalcoEvent").log(function(){return{candidates_blob:JSON.stringify(f),processing_time:e,surface:a.$9}}),a.$18())},function(a){})};return a}();e.exports=a},null);
__d("createUFI2SmartComposeTypeaheadComposerPlugin",["requireCond","DraftModifier","EditorState","Keys","React","SelectionState","SimpleNUXMessage","SimpleNUXMessageTypes","SmartComposeTypeaheadHelper","cr:1265698","createUFI2ComposerPlugin","installUFI2ComposerInputDecorators"],function(a,b,c,d,e,f){"use strict";var g=b("React");function a(a){var c=a.environment,d=a.ftentidentifier,e=a.surface;return function(a){var f=new(b("SmartComposeTypeaheadHelper"))(e,c,d),h=function(d){babelHelpers.inheritsLoose(c,d);function c(a){var c;c=d.call(this,a)||this;c.state={nuxShown:b("cr:1265698")!=null&&!b("SimpleNUXMessage").hasUserSeenMessage(b("SimpleNUXMessageTypes").WORK_SMART_COMPOSE_NUX),typeahead:""};c.wrappedRef=g.createRef();c.$1=function(){if(!c.state.nuxShown)return;b("SimpleNUXMessage").markMessageSeenByUser(b("SimpleNUXMessageTypes").WORK_SMART_COMPOSE_NUX);c.setState({nuxShown:!1})};c.handleKeypress=function(a){f.updateTypeSpeed();if(c.state.typeahead.length>0&&f.isCursorAtEnd())switch(a.keyCode){case b("Keys").RIGHT:case b("Keys").TAB:c.commitTypeahead();a.preventDefault();c.$1();break}return c.props.inputProps.keyBindingFn&&c.props.inputProps.keyBindingFn(a)};return c}var e=c.prototype;e.render=function(){var c=this;f.setEnteredText(this.getEnteredText());var d=this.getCursorPosition(),e=d.end;d=d.start;f.setCursorPosition(d,e);return g.jsxs("div",{ref:this.wrappedRef,children:[g.jsx(a,babelHelpers["extends"]({},this.props,{inputProps:babelHelpers["extends"]({},this.props.inputProps,{composerState:b("installUFI2ComposerInputDecorators")(this.props.inputProps.composerState,f.getDraftDecorator()),keyBindingFn:this.handleKeypress})})),b("cr:1265698")&&g.jsx(b("cr:1265698"),{contextRef:function(){return c.wrappedRef.current},onCloseButtonClick:this.$1,shown:this.state.nuxShown&&this.state.typeahead!==""})]})};e.componentDidMount=function(){var a=this;f.onSuggestionChange(function(b){return a.setState({typeahead:b})})};e.componentWillUnmount=function(){f.reset()};e.commitTypeahead=function(){var a=this,c=this.state.typeahead;if(c.length===0)return;f.logSuggestionInserted();this.props.inputProps.onComposerStateChange(function(d){var e=d.inputState;if(e.__type!=="editor-state-based")return d;var f=e.editorState,g=f.getCurrentContent(),h=f.getSelection(),i=a.getEnteredText().length+c.length;i=new(b("SelectionState"))({anchorKey:h.getAnchorKey(),anchorOffset:i,focusKey:h.getFocusKey(),focusOffset:i,hasFocus:!0,isBackward:!1});return babelHelpers["extends"]({},d,{inputState:babelHelpers["extends"]({},e,{editorState:b("EditorState").forceSelection(b("EditorState").push(f,b("DraftModifier").insertText(g,h,c),"insert-fragment"),i)})})})};e.getCursorPosition=function(){var a=this.props.inputProps.composerState.inputState,b;if(a.__type==="editor-state-based"){var c=a.editorState.getSelection();b=c.getStartOffset();c=c.getEndOffset()}else{var d;b=((d=a.selectionOffsets)==null?void 0:d.start)||0;c=((d=a.selectionOffsets)==null?void 0:d.end)||0}return{end:c,start:b}};e.getEnteredText=function(){var a=this.props.inputProps.composerState.inputState;return a.__type==="editor-state-based"?a.editorState.getCurrentContent().getPlainText():a.text};return c}(g.Component);return b("createUFI2ComposerPlugin")(h)}}e.exports=a},null);